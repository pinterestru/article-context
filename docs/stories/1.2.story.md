# Story 1.2: Core Layout and Routing Implementation

## Status
Draft

## Story
**As a** user,
**I want** to access articles via clean URLs,
**so that** I can navigate directly to specific content.

## Acceptance Criteria
1. Implement root layout.tsx with HTML structure and global providers
2. Create dynamic [slug] route under app/article/ directory
3. Implement loading.tsx with skeleton UI for article loading state
4. Create not-found.tsx and error.tsx pages with proper styling
5. Set up global CSS with Tailwind configuration
6. Implement responsive container component for consistent spacing
7. Verify routing works for /article/test-slug pattern
8. Ensure proper meta tags and viewport configuration

## Tasks / Subtasks
- [ ] Create root layout implementation (AC: 1, 8)
  - [ ] Create src/app/layout.tsx with proper HTML structure
  - [ ] Add viewport and meta tags configuration
  - [ ] Import and apply global CSS from src/styles/globals.css
  - [ ] Set up font variables (--font-sans, --font-mono)
  - [ ] Add body className with `bg-background text-foreground`
  - [ ] Ensure proper children rendering with React.ReactNode type
- [ ] Set up global CSS configuration (AC: 5)
  - [ ] Create src/styles/globals.css with Tailwind imports
  - [ ] Add CSS custom properties for theming (colors, spacing, animations)
  - [ ] Configure container padding and section spacing variables
  - [ ] Add border and shadow variables
  - [ ] Include cloaking styles for `.is-black-mode` class
- [ ] Create article routing structure (AC: 2, 7)
  - [ ] Create src/app/(marketing)/article/[slug]/page.tsx
  - [ ] Implement basic page component that accepts slug parameter
  - [ ] Add TypeScript types for page props with params
  - [ ] Create placeholder content displaying the slug
  - [ ] Test routing with /article/test-slug URL
- [ ] Implement loading states (AC: 3)
  - [ ] Create src/app/(marketing)/article/[slug]/loading.tsx
  - [ ] Build skeleton UI component with proper animations
  - [ ] Use Tailwind classes for loading animations (animate-pulse)
  - [ ] Match the expected article layout structure
- [ ] Create error handling pages (AC: 4)
  - [ ] Create src/app/not-found.tsx for 404 errors
  - [ ] Create src/app/(marketing)/article/[slug]/error.tsx for route errors
  - [ ] Create src/app/global-error.tsx for application-wide errors
  - [ ] Style error pages with consistent design
  - [ ] Add appropriate error messages and user guidance
- [ ] Build container component (AC: 6)
  - [ ] Create src/components/layout/Container.tsx
  - [ ] Use forwardRef pattern with proper TypeScript types
  - [ ] Extend HTMLAttributes<HTMLDivElement> for props
  - [ ] Implement responsive max-width with padding
  - [ ] Use cn() utility for className merging
  - [ ] Add component display name
- [ ] Set up middleware for routing (AC: 7)
  - [ ] Create src/middleware.ts with Next.js middleware
  - [ ] Configure internationalization with next-intl
  - [ ] Add click tracking preservation (yclid/gclid parameters)
  - [ ] Set up locale handling with 'en' and 'ru' support
  - [ ] Configure paths to skip middleware (api, _next, static files)
- [ ] Verify implementation (AC: 7, 8)
  - [ ] Test article route navigation
  - [ ] Verify loading states appear correctly
  - [ ] Check error page rendering
  - [ ] Confirm meta tags in browser DevTools
  - [ ] Test responsive container behavior

## Dev Notes
### Previous Story Insights
Story 1.1 established the project foundation with Next.js 15.3.4, TypeScript strict mode, and the basic directory structure. The project uses pnpm as package manager and has ESLint/Prettier configured.

### Layout Structure
Based on [Source: architecture/routing.md#route-configuration]:
- Root layout must support internationalization middleware
- Click tracking parameters (yclid/gclid) must be preserved in cookies
- Cookie settings: httpOnly, secure (in production), sameSite: 'strict', maxAge: 300 (5 minutes)
- Middleware should skip: /api/, /_next/, and static file paths

### Component Standards
Based on [Source: architecture/component-standards.md#component-template]:
- All components should use forwardRef when accepting refs
- Props interfaces must be exported
- Use cn() utility from @/lib/utils/cn for className merging
- Components need display names for debugging
- Container should extend HTMLAttributes<HTMLDivElement>

### Styling Configuration
Based on [Source: architecture/styling-guidelines.md#styling-approach]:
- Global CSS location: src/styles/globals.css
- Required CSS custom properties:
  - Colors: --background, --foreground, --primary, --border, etc.
  - Spacing: --container-padding (1rem), --section-spacing (4rem)
  - Animations: --animation-fast (150ms), --animation-normal (300ms)
  - Typography: --font-sans, --font-mono
- Cloaking class: .is-black-mode for special content handling

### File Locations
Based on [Source: architecture/source-tree.md]:
```
src/
├── app/
│   ├── (marketing)/
│   │   └── article/
│   │       └── [slug]/
│   │           ├── page.tsx
│   │           ├── loading.tsx
│   │           └── error.tsx
│   ├── layout.tsx
│   ├── global-error.tsx
│   └── not-found.tsx
├── components/
│   └── layout/
│       └── Container.tsx
├── styles/
│   └── globals.css
└── middleware.ts
```

### Internationalization Setup
Based on [Source: architecture/routing.md]:
- Supported locales: ['en', 'ru']
- Default locale: 'en'
- Locale prefix: 'as-needed' (only show when not default)
- Messages location: src/messages/{locale}.json

### Testing
Based on [Source: architecture/testing-strategy.md]:
- Create basic component tests for Container component
- Test file location: src/components/layout/Container.test.tsx
- Verify routing behavior with integration tests
- Use renderWithProviders utility for component testing

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-07 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record
### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_