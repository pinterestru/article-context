# Story 3.2: Promocode Display Widget

## Status
Draft

## Story
**As a** user,
**I want** to see available promocodes clearly,
**so that** I can quickly find and use discount codes.

## Acceptance Criteria
1. Create PromoCodeWidget component with discount percentage display
2. Implement "Click to Reveal" initial state showing discount amount
3. Add smooth slide/fade animation on code reveal
4. Display promocode in easy-to-read monospace font
5. Include expiration date if provided by API
6. Support multiple visual variants (inline, card, banner)
7. Ensure widget is mobile-touch optimized
8. Match design to feel native within article content

## Tasks / Subtasks
- [ ] Create PromoCodeWidget component (AC: 1, 6)
  - [ ] Create src/components/widgets/PromoCodeWidget.tsx
  - [ ] Define PromoCodeWidgetProps interface
  - [ ] Implement forwardRef pattern for DOM access
  - [ ] Create variant prop with union type (inline | card | banner)
  - [ ] Add displayName for debugging
  - [ ] Export component and interface
- [ ] Implement click-to-reveal functionality (AC: 2, 3)
  - [ ] Create local state for reveal status
  - [ ] Show discount percentage in initial state
  - [ ] Add "Click to Reveal" button/area
  - [ ] Implement slide animation with Tailwind transitions
  - [ ] Use duration-300 for smooth reveal animation
  - [ ] Add fade effect for content transition
- [ ] Style promocode display (AC: 4, 8)
  - [ ] Apply monospace font for code display
  - [ ] Use font-mono Tailwind class
  - [ ] Set appropriate text size (text-lg or text-xl)
  - [ ] Add padding and background for readability
  - [ ] Ensure contrast meets WCAG AA standards
  - [ ] Style to blend with article content
- [ ] Add expiration date handling (AC: 5)
  - [ ] Parse expiration from widget config
  - [ ] Format date for user-friendly display
  - [ ] Show countdown if less than 24 hours
  - [ ] Use muted-foreground color for expiry text
  - [ ] Handle missing expiration gracefully
- [ ] Implement visual variants (AC: 6)
  - [ ] Create inline variant (minimal, fits in text)
  - [ ] Create card variant (bordered container)
  - [ ] Create banner variant (full-width emphasis)
  - [ ] Use cn() helper for conditional styling
  - [ ] Apply appropriate shadows and borders
  - [ ] Ensure consistent spacing across variants
- [ ] Optimize for mobile interaction (AC: 7)
  - [ ] Set minimum touch target size (44x44px)
  - [ ] Add appropriate padding for finger taps
  - [ ] Test on various mobile viewports
  - [ ] Ensure text remains readable on small screens
  - [ ] Add haptic feedback support if available
- [ ] Integrate with widget framework (AC: 1, 2)
  - [ ] Register widget in WidgetRegistry
  - [ ] Map 'promocode' action type to component
  - [ ] Parse config from data-param attributes
  - [ ] Validate config with Zod schema
  - [ ] Handle hydration lifecycle properly
- [ ] Add animation polish (AC: 3, 8)
  - [ ] Use React 19 useTransition for smooth updates
  - [ ] Add hover effects with shadow transitions
  - [ ] Implement scale effect on interaction
  - [ ] Ensure animations respect prefers-reduced-motion
  - [ ] Test animation performance
- [ ] Write comprehensive tests (AC: 1-8)
  - [ ] Unit test component with all variants
  - [ ] Test reveal animation behavior
  - [ ] Test expiration date formatting
  - [ ] Test mobile touch interactions
  - [ ] Test accessibility with screen readers
  - [ ] E2E test widget in article context

## Dev Notes
### Previous Story Insights
- Story 3.1 created the widget framework with registry and hydration system
- Widgets only hydrate when .is-black-mode class is present
- Error boundaries wrap each widget instance
- Use BaseWidget patterns established in 3.1

### Component Implementation Pattern
Based on [Source: architecture/component-standards.md]:
```typescript
'use client';

import { forwardRef } from 'react';
import { cn } from '@/lib/utils';

export interface PromoCodeWidgetProps extends HTMLAttributes<HTMLDivElement> {
  code: string;
  discount: string;
  description?: string;
  expiresAt?: string;
  variant?: 'inline' | 'card' | 'banner';
}

export const PromoCodeWidget = forwardRef<HTMLDivElement, PromoCodeWidgetProps>(
  ({ code, discount, description, expiresAt, variant = 'card', className, ...props }, ref) => {
    // Implementation
  }
);

PromoCodeWidget.displayName = 'PromoCodeWidget';
```

### Animation and Styling
Based on [Source: architecture/styling-guidelines.md]:
```css
/* Animation durations */
--animation-fast: 150ms;
--animation-normal: 300ms;
--animation-slow: 500ms;

/* Typography for promo codes */
font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
```

### React 19 Optimistic Updates
Based on [Source: architecture/react-19-features.md]:
```typescript
// For copy functionality in next story
const [optimisticCopied, setOptimisticCopied] = useOptimistic(
  copied,
  (state, newCopied) => newCopied
);

// For smooth reveal animation
const [isPending, startTransition] = useTransition();
```

### Variant Styling Examples
Based on [Source: architecture/component-standards.md]:
```typescript
const variantStyles = {
  inline: 'inline-flex items-center gap-2 px-3 py-1 text-sm',
  card: 'block p-6 border rounded-lg shadow-md hover:shadow-xl transition-all duration-200',
  banner: 'block w-full p-8 bg-gradient-to-r from-primary/10 to-primary/5'
};
```

### Mobile Optimization
Based on [Source: architecture/styling-guidelines.md]:
- Minimum touch target: 44x44px
- Responsive padding: px-4 py-2 minimum
- Container padding: 1rem on mobile
- Test across viewport sizes

### Widget Configuration Schema
Based on [Source: architecture/type-safety-validation.md]:
```typescript
const PromoCodeConfigSchema = z.object({
  type: z.literal('promocode'),
  code: z.string().regex(/^[A-Z0-9]{4,20}$/),
  discount: z.string(),
  description: z.string().optional(),
  expiresAt: z.string().datetime().optional(),
  variant: z.enum(['inline', 'card', 'banner']).optional()
});
```

### Accessibility Requirements
Based on [Source: architecture/user-interface-design-goals.md#accessibility-wcag-aa]:
- Ensure color contrast ratios meet WCAG AA
- Provide screen reader announcements
- Support keyboard navigation
- Use semantic HTML elements
- Test with assistive technologies

### File Locations
Based on [Source: architecture/source-tree.md]:
```
src/
├── components/
│   └── widgets/
│       ├── PromoCodeWidget.tsx
│       └── PromoCodeWidget.test.tsx
```

### Testing
#### Test File Locations
Based on [Source: architecture/testing-strategy.md]:
- Component tests: `src/components/widgets/__tests__/PromoCodeWidget.test.tsx`
- E2E tests: `e2e/promocode-widget.spec.ts`

#### Testing Standards
- Test all visual variants
- Mock different configurations
- Test animation states
- Verify mobile interactions
- Check accessibility compliance

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-07 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record
### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_